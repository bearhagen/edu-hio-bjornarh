<!DOCTYPE HTML>
<html>
	<head>
		<title>Del 4 - Oppgave 4.1</title>
		<style>
			form {
				display: block;
				width: 100%;
			}

			form > input,
			form > button,
			form > select,
			form > textarea {
				display: inline-block;
			}
		</style>
	</head>
	<body>
		<form id="form-get-weather">
			<select name="month">
				<option value="null" disabled selected>Velg måned</option>
				<option value="1">Jan</option>
				<option value="2">Feb</option>
				<option value="3">Mar</option>
				<option value="4">Apr</option>
				<option value="5">Mai</option>
				<option value="6">Jun</option>
				<option value="7">Jul</option>
				<option value="8">Aug</option>
				<option value="9">Sep</option>
				<option value="10">Okt</option>
				<option value="11">Nov</option>
				<option value="12">Des</option>
			</select>
			<select name="year">
				<option value="null" disabled selected>Velg år</option>
				<option value="2015">2015</option>
				<option value="2014">2014</option>
				<option value="2013">2013</option>
			</select>
			<button type="submit">Hent data</button>
		<form>
		<table>
			<tbody id="output">
			</tbody>
		</table>
		<script>
			window.onload = ready;

			function ready() {
				var form = document.querySelector("#form-get-weather");
				form.onsubmit = function(e) {
					e.preventDefault(); // Stopp standard oppførsel til form elementet.
					getWeather(document.querySelector("#output"), form.elements["month"], form.elements["year"]);
				}
			}

			function getWeather(output, month, year) {
				var xhr = xmlHttpRequest;
				xhr.onreadystatechange = function() {
					if (xhr.readyState === xhr.DONE && xhr.status === 200) {
						displayWeather(output, xhr.responseText);
					}
				}
				xhr.open("GET", "./" + month + "." + year + ".csv");
				xhr.send();
			}

			function displayWeather(output, data) {
				var outputData = "";
				data.split(/\n/g).forEach(function(i, row) {
					var columns = row.split(/\;/g);
					var weatherIcon = new Image();
					weatherIcon.src = columns[1] + ".png"

					outputData += "<tr><td>";
					outputData += "Dag " + columns[0] + ": ";
					outputData += weatherIcon;
					outputData += " " + columns[1] + ". ";
					outputData += columns[2] + " grader.";
					outputData += columns[4] + " m/s vind fra " + vindnavn[columns[3]] + ".";
					outputData += "</td><tr>";
				});

				output.innerHTML = outputData;
			}
		</script>
	</body>
</html>
